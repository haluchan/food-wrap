function $_GET(e){var t={};return window.location.href.replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(e,a,i){t[a]=void 0!==i?i:""}),e?t[e]?t[e]:null:t}function getCurrentFolderName(){var e=window.location.href,t=e.replace(/\/$/,"").split("/");return t[t.length-2]}function getCurentPageName(){var e=window.location.pathname;return e.substring(e.lastIndexOf("/")+1).split(".")[0]}function initListCommon(){for($("#loading").empty(),$("#loading").append('<div class="spinner">'),$i=1;$i<=5;$i++)$("#loading .spinner").append('<div class="rect'+$i+'"></div>');$(".bu_insert").on("click",function(){parent.goPage(getCurrentFolderName()+"/insert.html?page="+$page+"&e_no="+toNumber($_GET("e_no")))})}function setTableHeader(){$("input, select").hasClass("filter")&&($.each($arrFilterFields,function(e,t){$("#"+e+".filter").val(t[0])}),$("button.bu_search").on("click",function(){$.each($arrFilterFields,function(e,t){$("#"+e+".filter").length&&($arrFilterFields[e][0]=$("#"+e+".filter").val())}),$page=1,getList()})),$(".input-reset").on("click",function(){$("#"+$(this).attr("icon-for")).val("")}),$.each($arrFields,function(e,t){if(t.length>0)if(t==getTablePrefix()+"_show"||t==getTablePrefix()+"_order"){var a="";t!=getTablePrefix()+"_show"&&t!=getTablePrefix()+"_order"||(a="editable"),$("table.list thead").append('<th class="bu '+a+'" order="'+t+'">'+e+"</th>")}else $("table.list thead").append('<th class="bu" order="'+t+'">'+e+"</th>");else $("table.list thead").append("<th>"+e+"</th>")}),$("table.list thead th[order="+$order_1+"]").addClass("select"),$("table.list th").on("click",function(){null!=$(this).attr("order")&&"preorder-single"!==getCurrentFolderName()&&"coupon-single"!==getCurrentFolderName()&&($page=1,$(this).attr("order")==$order_1?$order_2="d"==$order_2?"a":"d":($order_1=$(this).attr("order"),$order_2="d"),$("table.list th").removeClass("select"),$(this).addClass("select"),getList())})}function getList(){$("#loading").show(),$("table.list").hide(),$.post("../func.php",{func:"PageList",table:$table,fields:getArrFieldsStr(),arrFilterFields:$arrFilterFields,arrOtherFields:$arrOtherFields,order:$order_1+","+$order_2,page:$page},function(data){if($datarows=data.rows,$("table.list tbody").empty(),1==toNumber(data.OK)){for($i=0;$i<data.rows.length;$i++)$("table.list tbody").append("<tr></tr>"),$.each($arrFields,function($key,$val){if($val==getTablePrefix()+"_show"||$val==getTablePrefix()+"_order"){var $control="",isEditable="";$control=$val.substr(2,$val.length-1),isEditable="editable",$("table.list tbody tr:nth-child("+($i+1)+")").append('<td class="'+isEditable+'" type="edit" control="'+$control+'" no="'+eval("data.rows["+$i+"]."+getTablePrefix()+"_no")+'" data-role="'+$val+'" data-val="'+eval("data.rows["+$i+"]."+$val)+'"><span class="value">'+eval("data.rows["+$i+"]."+$val)+"</span></td>")}else $val.length>0&&$("table.list tbody tr:nth-child("+($i+1)+")").append('<td data-role="'+$val+'">'+eval("data.rows["+$i+"]."+$val)+"</td>"),"功能"==$key&&($("table.list tbody tr:nth-child("+($i+1)+")").append("<td></td>"),1==$arrButtons.Edit&&$("table.list tbody tr:nth-child("+($i+1)+") td:last-child").append('<button class="bu_edit bu rippleria" no="'+eval("data.rows["+$i+"]."+getTablePrefix()+"_no")+'"><i class="fa fa-pencil"></i><span>編輯</span></button>'),1==$arrButtons.Del&&("Mandarin_201710_Admin"==$table?$("table.list tbody tr:nth-child("+($i+1)+") td:last-child").append('<button class="bu_del bu rippleria" index="'+$i+'" no="'+eval("data.rows["+$i+"]."+getTablePrefix()+"_no")+'" title="'+eval("data.rows["+$i+"]."+getTablePrefix()+"_id")+'"><i class="fa fa-trash"></i><span>刪除</span></button>'):$("table.list tbody tr:nth-child("+($i+1)+") td:last-child").append('<button class="bu_del bu rippleria" index="'+$i+'" no="'+eval("data.rows["+$i+"]."+getTablePrefix()+"_no")+'" title="'+eval("data.rows["+$i+"]."+getTablePrefix()+"_name")+'"><i class="fa fa-trash"></i><span>刪除</span></button>')),1==$arrButtons.View&&$("table.list tbody tr:nth-child("+($i+1)+") td:last-child").append('<button class="bu_view bu rippleria" no="'+eval("data.rows["+$i+"]."+getTablePrefix()+"_no")+'"><i class="fa fa-eye"></i><span>檢視</span></button>'),1==$arrButtons.Prizedetail&&$("table.list tbody tr:nth-child("+($i+1)+") td:last-child").append('<button class="bu_prizedetail bu rippleria" no="'+eval("data.rows["+$i+"]."+getTablePrefix()+"_no")+'"><i class="fa fa-user-circle"></i><span>中獎者</span></button>'))});$("table.list tbody td[type=edit]").on("dblclick",function(){$(this).off("click"),$(this).attr("data-role")==getTablePrefix()+"_show"&&($type="",$(this).attr("data-role")==getTablePrefix()+"_show"&&($type="show"),$("table.list tbody td[type=edit] select").remove(),$("table.list tbody td[type=edit] span").show(),$(this).children("span").hide(),$(this).append("<select></select>"),$(this).children("select").append('<option value="0">隱藏</option>'),$(this).children("select").append('<option value="1">顯示</option>'),$(this).children("select").get(0).selectedIndex=$(this).attr("data-val"),$(this).children("select").focus(),$(this).children("select").on("change",function(){$.post("../func.php",{func:"ChangeStatus",type:$type,table:$table,no:$(this).parent().attr("no"),status:$(this).val()},function(e){var t=$("table.list tbody td[type=edit][no="+e.no+"][control="+$type+"]");if(1==e.OK)switch(t.attr("data-val",e.result),t.children("span").empty(),e.result){case 0:t.children("span").append("隱藏");break;case 1:t.children("span").append("顯示")}else alert("顯示狀態更新失敗, 請重新再試一次");t.children("select").remove(),t.children("span").show(),t.on("click")},"json")}).on("focusout",function(){$(this).trigger("change")})),$(this).attr("data-role")==getTablePrefix()+"_order"&&($(this).children("span").hide(),$title="",$pattern="",$type="",$(this).attr("data-role")==getTablePrefix()+"_order"&&($pattern="[0-9]+([.,][0-9]+)?",$title="只接受到小數點第2位的數字",$type="order"),$(this).append('<input type="text" pattern="'+$pattern+'" title="'+$title+'" value="'+$(this).attr("data-val")+'">'),$(this).children("input").focus(),$(this).children("input").on("focusout",function(){$.post("../func.php",{func:"ChangeStatus",type:$type,table:$table,no:$(this).parent().attr("no"),status:$(this).val()},function(e){var t=$("table.list tbody td[type=edit][no="+e.no+"][control=order]");1==e.OK?$order_1==getTablePrefix()+"_order"?getList():(t.attr("data-val",e.result),t.children("span").empty().append(e.result)):alert("權重更新失敗, 請重新再試一次"),$order_1==getTablePrefix()+"_order"&&0!=e.OK||(t.children("input").remove(),t.children("span").show(),t.on("click"))},"json")}).on("keypress",function(e){13==e.keyCode&&$(this).trigger("focusout")}))})}$("table.list tbody button").on("click",function(){$(this).hasClass("bu_edit")&&parent.goPage(getCurrentFolderName()+"/edit.html?no="+$(this).attr("no")+"&e_no="+$_GET("e_no")+"&page="+$page+"&order_1="+$order_1+"&order_2="+$order_2+"&arrFilterFields="+encodeURIComponent(JSON.stringify($arrFilterFields))),$(this).hasClass("bu_del")&&($(this).hasClass("disabled")?alert("【#"+$(this).attr("no")+" - "+$(this).attr("title")+"】己有人登記, 無法刪除"):delSingleData($table,$(this).attr("no"),$(this).attr("title"))),$(this).hasClass("bu_view")&&parent.goPage(getCurrentFolderName()+"/view.html?no="+$(this).attr("no")+"&e_no="+$_GET("e_no")+"&page="+$page+"&order_1="+$order_1+"&order_2="+$order_2+"&arrFilterFields="+encodeURIComponent(JSON.stringify($arrFilterFields))),$(this).hasClass("bu_goTester")&&("store"===getCurrentFolderName()&&(window.location.href="../tester/index.html?e_no="+$_GET("e_no")+"&s_no="+$(this).attr("no")),"store_1"===getCurrentFolderName()&&(window.location.href="../tester_1/index.html?e_no="+$_GET("e_no")+"&s_no="+$(this).attr("no"))),$(this).hasClass("bu_mms")&&($(this).hasClass("disabled")||(window.location.href="mms.html?no="+$(this).attr("no")+"&e_no="+$_GET("e_no")+"&page="+$page+"&order_1="+$order_1+"&order_2="+$order_2+"&arrFilterFields="+encodeURIComponent(JSON.stringify($arrFilterFields))))}),pageCustomization(),setPager(data.totalpages),$("#loading").hide(),$("table.list").show(),setTimeout(setIFrameHeight,500)},"json")}function delSingleData(e,t,a){confirm("確定刪除【#"+t+"】的記錄嗎?")&&$.post("../func.php",{func:"DelData",table:e,no:t},function(e){1==e.OK?(alert("成功刪除"),getList()):alert("刪除失敗")},"json")}function getArrFieldsStr(){var e="";return $.each($arrFields,function(t,a){var i=0;$.each($arrOtherFields,function(e,t){e===a&&(i=1)}),0===i&&a.length>0&&(e=0==e.length?a:e+","+a)}),$extraFields.length>0?e=e+","+$extraFields:e+=$extraFields,e}function setPager(e){var t=e>10?10:e,a=$page>1?parseInt($page,10)-1:1,i=$page<e?parseInt($page,10)+1:e,r=[],n=0;if(e<=1)$(".pager").empty();else{if($(".pager").empty(),$(".pager").append('<span class="bu" page="1"><i class="fa fa-fast-backward"></i></span>'),$(".pager").append('<span class="bu" page='+a+'><i class="fa fa-backward"></i></span>'),toNumber(e)>6)if($page>6)if(e-parseInt($page,10)>=4){for($i=parseInt($page,10)-5;$i<$page;$i++)r.push($i);for(n=parseInt($page,10)+4<e?parseInt($page,10)+4:e,$i=$page;$i<=n;$i++)r.push($i)}else for($i=e-9;$i<=e;$i++)r.push($i);else for($i=1;$i<=t;$i++)r.push($i);else for($i=1;$i<=e;$i++)r.push($i);for($i=0;$i<r.length;$i++)r[$i]==$page?$(".pager").append('<span class="bu select" page="'+r[$i]+'">'+r[$i]+"</span>"):$(".pager").append('<span class="bu" page="'+r[$i]+'">'+r[$i]+"</span>");$(".pager").append('<span class="bu" page='+i+'><i class="fa fa-forward"></i></span>'),$(".pager").append('<span class="bu" page='+e+'><i class="fa fa-fast-forward"></i></span>'),$(".pager").append('<span class="specialPage">第&nbsp;<input type="text" class="numbersOnly">&nbsp;頁&nbsp;<button class="bu">前往</button>'),$(".pager span:not(.specialPage)").on("click",function(){$page=$(this).attr("page"),getList()}),$(".pager button").on("click",function(){$(".pager input").val()<=e&&($page=$(".pager input").val()),getList()})}}function setIFrameHeight(){parent.setIFrameHeight()}function pageInsert(){$.post("../func.php",{func:"PageInsert",table:$table,fields:$arrFields},function(e){1==e.OK?alert("成功新增"):alert("新增失敗, 請再重新新增"),parent.goPage(getCurrentFolderName()+"/index.html"+location.search)},"json")}function pageShowData(){$.post("../func.php",{func:"PageSingleData",table:$table,no:$no,arrOtherFields:$arrOtherFields},function(e){0==e.ok?(alert("查無資料"),parent.goPage(getCurrentFolderName()+"/index.html"+location.search)):($rows=e.rows[0],$("input, span, textarea").each(function(e){if(!$(this).hasClass("nodata"))switch($(this).attr("type")){case"radio":$(this).val()==$rows[$(this).attr("id")]?$("input,span, textarea").get(e).checked=!0:$(this).removeAttr("checked");break;case"hidden":case"textarea":case"text":case"data":"data"==$(this).attr("type")?$(this).attr("id")==getTablePrefix()+"_show"?0==$rows[$(this).attr("id")]?$(this).empty().append("隱藏"):$(this).empty().append("顯示"):$(this).attr("id")==getTablePrefix()+"_is_exchange"?0==$rows[$(this).attr("id")]?$(this).empty().append("未領取"):$(this).empty().append("可領取"):$(this).attr("id")==getTablePrefix()+"_is_valid"?0==$rows[$(this).attr("id")]?$(this).empty().append("不可兌換"):$(this).empty().append("可兌換"):"view"==getCurentPageName()?$(this).empty().append(formatTextAreaString($rows[$(this).attr("id")])):$(this).empty().append($rows[$(this).attr("id")]):$(this).val($rows[$(this).attr("id")])}}),"Mandarin_201710_Prize"==$table&&pageCustomization($rows),setTimeout(setIFrameHeight,500))},"json")}function pageEdit(){$.post("../func.php",{func:"PageEdit",e_no:$_GET("e_no"),no:$no,table:$table,fields:$arrFields},function(e){1==e.OK?alert("成功編輯"):"Store"===$table&&-1===toNumber(e.OK)?("store"===getCurrentFolderName()&&alert("總數不可小於登記數量 (目前登記數量 : "+e.apply+")"),"store_1"===getCurrentFolderName()&&alert("總數不可小於登記數量，目前登記數量如下\r\n驅黑 : "+e.apply_1+"&nbsp/&nbsp;眼膜 : "+e.apply_2+"&nbsp/&nbsp;乳霜 : "+e.apply_3+"&nbsp/&nbsp;淡斑 : "+e.apply_4+"&nbsp/&nbsp;潔顏 : "+e.apply_5)):alert("編輯失敗, 請再重新編輯"),-1!==toNumber(e.OK)&&parent.goPage(getCurrentFolderName()+"/index.html"+location.search)},"json")}function getCityList(e,t){t=void 0!==t?t:"",$type="undefined"!=typeof $type?$type:"all",$.post("../func.php",{func:"CityList"},function(a){for($datarows=a.rows,$i=0;$i<$datarows.length;$i++)e.append('<option value="'+$datarows[$i].c_no+'">'+$datarows[$i].c_name+"</option>");""===t?e.prop("selectedIndex",0):e.val(t)},"json")}function getCityListByEvent(e,t){t=void 0!==t?t:"",$type="undefined"!=typeof $type?$type:"all",$.post("../func.php",{func:"CityListByEvent",no:toNumber($_GET("e_no"))},function(a){for($datarows=a.rows,$i=0;$i<$datarows.length;$i++)e.append('<option value="'+$datarows[$i].c_no+'">'+$datarows[$i].c_name+"</option>");""===t?e.prop("selectedIndex",0):e.val(t)},"json")}function initBuCancel(){$("#bu_cancel").on("click",function(){parent.goPage(getCurrentFolderName()+"/index.html"+location.search)})}function getTablePrefix(){return $prefix="","Admin"===$table.substr(-5)&&($prefix="a"),"User"==$table.substr(-4)&&($prefix="u"),$prefix}function isiOS(){return-1!=navigator.userAgent.indexOf("iPhone")||-1!=navigator.userAgent.indexOf("iPod")||-1!=navigator.userAgent.indexOf("iPad")}function toNumber(e){return+e}var $arrFolder={admin:"管理員管理",user:"登錄資料管理"},$arrPage={index:"列表",insert:"新增",edit:"編輯"},$i=0;$j=0;var $datarows=null;$(function(){0===$("footer").length&&$("footer").empty().append("@catchdesign 2017");var e="";switch(toNumber($_GET("e_no"))){case 1:e="【百優＋怡麗絲爾】";break;case 2:e="【東京櫃周年】";break;case 3:e="【心機彩粧】";break;case 4:e="【驅黑淨白】"}"mms"===getCurentPageName()?$("h1").empty().append(e+$arrFolder[getCurrentFolderName()]+" > "):$("h1").empty().append(e+$arrFolder[getCurrentFolderName()]+" > "+$arrPage[getCurentPageName()]),$(".rippleria").rippleria({duration:750,easing:"linear",color:"#d6d6d6"}),$.post("../func.php",{func:"IsAdmin"},function(e){1==e.OK?page_init():(alert("登入後閒置時間過久, 請重新登入"),window.parent.location.href="../index.html")},"json"),$("i.input-feedback, i.input-reset").each(function(){var e=0,t=0,a=$("#"+$(this).attr("icon-for")),i=parseInt(a.css("padding-top"),10),r=parseInt(a.css("padding-bottom"),10),n=parseInt(a.css("padding-left"),10),s=parseInt(a.css("padding-right"),10);e=a.position().top+(a.height()+i+r-$(this).height())/2,t=a.position().left+(a.width()+n+s)-$(this).width()-5,$(this).css({top:e,left:t}),$(this).show()}),"insert"!=getCurentPageName()&&"edit"!=getCurentPageName()||initBuCancel()}),$(".numbersOnly").keyup(function(){this.value!=this.value.replace(/[^0-9\.]/g,"")&&(this.value=this.value.replace(/[^0-9\.]/g,""))});